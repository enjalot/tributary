//(function(){
var Tributary=function(){function _assemble(e){var t=e.config;t.contexts=[];var n,r,i,s,o=t.get("endpoint");tributary.endpoint&&(o=tributary.endpoint),o==="delta"?(t.set("display","svg"),t.set("play",!0),t.set("loop",!0),t.set("autoinit",!0)):o==="cypress"?(t.set("display","canvas"),t.set("play",!0),t.set("autoinit",!0)):o==="hourglass"?(t.set("display","svg"),t.set("play",!0),t.set("autoinit",!0)):o==="curiosity"?(t.set("display","webgl"),t.set("play",!0),t.set("autoinit",!0)):o==="bigfish"?(t.set("display","svg"),t.set("play",!0),t.set("autoinit",!1),t.set("restart",!0)):o==="fly"?(t.set("display","canvas"),t.set("play",!0),t.set("autoinit",!1),t.set("restart",!0)):o==="ocean"&&t.set("display","div"),t.get("display")||t.set("display","svg"),t.set("endpoint","");var u=panel.select("#edit");tributary.edit=u,e.models.each(function(e){s=e.get("type"),n=tributary.make_context({config:t,model:e,display:display}),n&&(t.contexts.push(n),n.render(),e.get("filename")!=="inlet.js"&&n.execute(),tributary.make_editor({model:e}))}),t.contexts.forEach(function(e){e.model.get("filename")==="inlet.js"&&(tributary.autoinit=!0,e.execute(),tributary.autoinit=t.get("autoinit"))});var a=new tributary.ConfigView({el:"#config",model:t});a.render();var f=new tributary.FilesView({el:"#files",model:t});f.render();var l=new tributary.ControlsView({el:"#controls",model:t});l.render(),setup_header(e),tributary.events.trigger("show",t.get("tab")),tributary.events.on("show",function(e){t.set("tab",e)}),tributary.dims.display_percent=t.get("display_percent"),tributary.events.trigger("resize"),tributary.events.on("resize",function(){t.set("display_percent",tributary.dims.display_percent)})}function setup_header(e){setup_save(e.config);if(e.user){var t=e.user.userid,n='"<a href="'+e.gist.html_url+'">'+e.gist.description+'</a>" by ';e.user.url===""?n+=e.user.login:n+='<a href="'+e.user.url+'">'+e.user.login+"</a>",$("#gist_info").html(n),e.user.id!==tributary.userid&&($("#savePanel").attr("disabled","true"),$("#savePanel").attr("class","off"))}isNaN(tributary.userid)&&($("#savePanel").attr("disabled","true"),$("#savePanel").attr("class","off"))}function setup_save(e){$("#savePanel").on("click",function(t){d3.select("#syncing").style("display","block"),tributary.save_gist(e,"save",function(e,t){window.location=e})}),$("#forkPanel").on("click",function(t){d3.select("#syncing").style("display","block"),tributary.save_gist(e,"fork",function(e,t){window.location=e})}),$("#loginPanel").on("click",function(e){tributary.login_gist(tributary.loggedin,function(e,t){window.location=e})})}var tributary={};tributary.events=_.clone(Backbone.Events),tributary.data={},window.trib={},window.trib_options={},window.addEventListener("resize",function(e){tributary.events.trigger("resize",e)}),tributary.CodeModel=Backbone.Model.extend({defaults:{code:"",filename:"inlet.js",name:"inlet",type:"js",mode:"javascript",config:{coffee:!0,vim:!1,emacs:!1,hide:!1}},initialize:function(){this.binder()},binder:function(){this.on("error",this.handle_error)},handle_error:function(e){tributary.trace&&(console.trace(),console.log(e))},handle_coffee:function(){var e=this.get("code");return this.get("config").coffee&&this.get("type")=="cs"&&(e=CoffeeScript.compile(e,{bare:!0})),e},local_storage:function(e){e||(e="");var t=this.get("filename")+"/code/"+e;return localStorage[t]},set_local_storage:function(e,t){var n=this.get("filename")+"/code/"+t;localStorage[n]=e}}),tributary.CodeModels=Backbone.Collection.extend({model:tributary.CodeModel}),tributary.Config=Backbone.Model.extend({defaults:{endpoint:"tributary",display:"svg","public":!0,require:[],tab:"edit",display_percent:.7,play:!1,loop:!1,restart:!1,autoinit:!0,pause:!0,loop_type:"period",bv:!1,nclones:15,clone_opacity:.4,duration:3e3,ease:"linear",dt:.01},require:function(e,t){var n=this.get("require"),r=_.pluck(n,"url"),i=function(){return e(t,arguments)};require(r,i)},initialize:function(){this.on("hide",function(){this.contexts.forEach(function(e){e.model.trigger("hide")})},this)}}),tributary.ConfigView=Backbone.View.extend({render:function(){var e=this;d3.select(this.el).append("span").classed("config_title",!0).text("Display:");var t=d3.select(this.el).append("div").classed("displaycontrols",!0).selectAll("div.config").data(tributary.displays).enter().append("div").classed("config",!0),n=this.model.get("display");t.each(function(e){e.name===n&&d3.select(this).classed("config_active",!0)}),t.append("span").text(function(e){return e.name}),t.append("span").text(function(e){return" "+e.description}).classed("description",!0),t.on("click",function(t){d3.select(this.parentNode).selectAll("div.config").classed("config_active",!1),d3.select(this).classed("config_active",!0),e.model.set("display",t.name),tributary.events.trigger("execute")}),d3.select(this.el).append("span").classed("config_title",!0).text("Time Controls:");var r=d3.select(this.el).append("div").classed("timecontrols",!0).selectAll("div.config").data(tributary.time_controls).enter().append("div").classed("config",!0);r.each(function(t){e.model.get(t.name)&&d3.select(this).classed("config_active",!0)}),r.append("span").text(function(e){return e.name}),r.append("span").text(function(e){return" "+e.description}).classed("description",!0),r.on("click",function(t){var n=!e.model.get(t.name);d3.select(this).classed("config_active",n),e.model.set(t.name,n)})}}),tributary.Context=Backbone.View.extend({initialize:function(){},execute:function(){},render:function(){}}),tributary.TributaryContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),tributary.events.on("execute",this.execute,this),this.config=this.options.config,this.config.on("change:display",this.set_display,this);var e=this.config;tributary.init=undefined,tributary.run=undefined,tributary.loop=e.get("loop"),tributary.autoinit=e.get("autoinit"),tributary.pause=e.get("pause"),tributary.loop_type=e.get("loop_type"),tributary.bv=e.get("bv"),tributary.nclones=e.get("nclones"),tributary.clone_opacity=e.get("clone_opacity"),tributary.duration=e.get("duration"),tributary.ease=d3.ease(e.get("ease")),tributary.t=0,tributary.dt=e.get("dt"),tributary.reverse=!1,tributary.render=function(){},tributary.execute=function(){if(tributary.run!==undefined){var e=tributary.t;tributary.loop&&(e=tributary.ease(tributary.t)),tributary.run(tributary.g,e,0)}},tributary.timer={then:new Date,duration:tributary.duration,ctime:tributary.t},d3.timer(function(){tributary.render();if(tributary.pause)return!1;var t=new Date,n=t-tributary.timer.then,r;if(tributary.loop){tributary.reverse?r=tributary.timer.ctime*n/tributary.timer.duration*-1:r=(1-tributary.timer.ctime)*n/tributary.timer.duration,tributary.t=tributary.timer.ctime+r;if(tributary.t>=1||tributary.t<=0||tributary.t==="NaN")tributary.loop_type==="period"?(tributary.t=0,tributary.timer.then=new Date,tributary.timer.duration=tributary.duration,tributary.timer.ctime=tributary.t,tributary.reverse=!1):tributary.loop_type==="pingpong"?(tributary.t=!tributary.reverse,tributary.timer.then=new Date,tributary.timer.duration=tributary.duration,tributary.timer.ctime=tributary.t,tributary.reverse=!tributary.reverse):tributary.t!==0&&(tributary.t=1,tributary.pause=!0);tributary.t===!0&&(tributary.t=1),tributary.t===!1&&(tributary.t=0)}else tributary.t+=tributary.dt;tributary.execute(),e.trigger("tick",tributary.t)})},execute:function(){var e=this.model.handle_coffee();try{tributary.initialize=new Function("g","tributary",e)}catch(t){return this.model.trigger("error",t),!1}try{window.trib={},window.trib_options={},trib=window.trib,trib_options=window.trib_options,tributary.autoinit&&tributary.clear(),this.clones&&$(this.clones.node()).empty(),tributary.bv&&this.make_clones(),tributary.initialize(tributary.g,tributary),tributary.autoinit&&tributary.init!==undefined&&tributary.init(tributary.g,0),tributary.execute()}catch(n){return this.model.trigger("error",n),!1}return this.model.trigger("noerror"),!0},render:function(){this.set_display()},set_display:function(){var e=this;this.$el.empty();var t=this.config.get("display");t==="svg"?this.make_svg():t==="canvas"?this.make_canvas():t==="webgl"?this.make_webgl():t==="div"?(this.g=d3.select(this.el),tributary.g=this.g,tributary.clear=function(){e.$el.empty()}):tributary.clear=function(){e.$el.empty()}},make_svg:function(){this.svg=d3.select(this.el).append("svg").attr({xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink","class":"tributary_svg"}),tributary.g=this.svg,tributary.clear=function(){$(tributary.g.node()).empty()}},make_canvas:function(){tributary.clear=function(){tributary.canvas.width=tributary.sw,tributary.canvas.height=tributary.sh,tributary.ctx.clearRect(0,0,tributary.sw,tributary.sh)},tributary.canvas=d3.select(this.el).append("canvas").classed("tributary_canvas",!0).node(),tributary.ctx=tributary.canvas.getContext("2d"),tributary.g=tributary.ctx},make_clones:function(){this.clones=this.svg.selectAll("g.clones").data([0]),this.clones.enter().append("g").attr("class","clones"),tributary.g=this.svg.selectAll("g.delta").data([0]),tributary.g.enter().append("g").attr("class","delta");var e=d3.range(tributary.nclones),t=this.clones.selectAll("g.bvclone").data(e).enter().append("g").attr("class","bvclone").style("opacity",tributary.clone_opacity);t.each(function(e,t){var n=t+1,r=d3.select(this);tributary.init(r,n);var i=tributary.ease(n/(tributary.nclones+1));tributary.run(r,i,n)})},make_webgl:function(){function e(){windowHalfX=tributary.sw/2,windowHalfY=tributary.sh/2,tributary.camera.aspect=tributary.sw/tributary.sh,tributary.camera.updateProjectionMatrix(),tributary.renderer.setSize(tributary.sw,tributary.sh)}container=this.el,tributary.camera=new THREE.PerspectiveCamera(70,tributary.sw/tributary.sh,1,1e3),tributary.camera.position.y=150,tributary.camera.position.z=500,tributary.scene=new THREE.Scene,THREE.Object3D.prototype.clear=function(){var e=this.children,t;for(t=e.length-1;t>=0;t--){var n=e[t];n.clear(),this.remove(n)}},tributary.renderer=new THREE.WebGLRenderer,tributary.renderer.setSize(tributary.sw,tributary.sh),container.appendChild(tributary.renderer.domElement),tributary.render=function(){tributary.renderer.render(tributary.scene,tributary.camera)},tributary.render(),tributary.events.on("resize",e,!1),tributary.clear=function(){tributary.scene.clear()}}}),tributary.JSONContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),this.model.on("change:code",function(){tributary.events.trigger("execute")})},execute:function(){try{var e=JSON.parse(this.model.get("code"));tributary[this.model.get("name")]=e}catch(t){return this.model.trigger("error",t),!1}return this.model.trigger("noerror"),!0},render:function(){}}),tributary.JSContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),this.model.on("change:code",function(){tributary.events.trigger("execute")})},execute:function(){try{eval(this.model.get("code"))}catch(e){return this.model.trigger("error",e),!1}return this.model.trigger("noerror"),!0},render:function(){}}),tributary.CSContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),this.model.on("change:code",function(){tributary.events.trigger("execute")})},execute:function(){try{eval(this.model.handle_coffee())}catch(e){return this.model.trigger("error",e),!1}return this.model.trigger("noerror"),!0},render:function(){}}),tributary.CSVContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),this.model.on("change:code",function(){tributary.events.trigger("execute")})},execute:function(){try{var e=d3.csv.parse(this.model.get("code"));tributary[this.model.get("name")]=e}catch(t){return this.model.trigger("error",t),!1}return this.model.trigger("noerror"),!0},render:function(){}}),tributary.CSSContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),this.model.on("change:code",function(){tributary.events.trigger("execute")})},execute:function(){try{this.el.textContent=this.model.get("code")}catch(e){return this.model.trigger("error",e),!1}return this.model.trigger("noerror"),!0},render:function(){this.el=d3.select("head").selectAll("style.csscontext").data([this.model],function(e){return e.cid}).enter().append("style").classed("csscontext",!0).attr({type:"text/css"}).node(),console.log("style el",this.el)}}),tributary.HTMLContext=tributary.Context.extend({initialize:function(){this.model.on("change:code",this.execute,this),this.model.on("change:code",function(){tributary.events.trigger("execute")})},execute:function(){try{$(this.el).html(this.model.get("code"))}catch(e){return this.model.trigger("error",e),!1}return this.model.trigger("noerror"),!0},render:function(){this.el=d3.select("body").selectAll("div.htmlcontext").data([this.model],function(e){return e.cid}).enter().append("div").classed("htmlcontext",!0).node()}}),tributary.Editor=Backbone.View.extend({initialize:function(){this.config=this.model.get("config"),this.model.on("show",function(){d3.select(this.el).style("display","")},this),this.model.on("hide",function(){d3.select(this.el).style("display","none")},this)},render:function(){var e=this;d3.select(this.el).classed("editor",!0),this.cm=CodeMirror(this.el,{mode:e.model.get("mode"),theme:"lesser-dark",lineNumbers:!0,onChange:function(){var t=e.cm.getValue();e.model.set("code",t)}}),this.cm.setValue(this.model.get("code")),this.inlet=Inlet(this.cm),this.model.on("error",function(){d3.select(e.el).select(".CodeMirror-gutter").classed("error",!0)}),this.model.on("noerror",function(){d3.select(e.el).select(".CodeMirror-gutter").classed("error",!1)})}}),tributary.gist=function(e,t){tributary.gistid=e;var n={},r="?cachebust="+Math.random()*0xf12765df4c9b2;d3.json("https://api.github.com/gists/"+e+r,function(e){n.gist=e,e.user===null||e.user===undefined?n.user={login:"anon",url:"",userid:-1}:n.user=e.user;var r;try{r=e.files["config.json"]}catch(i){r=!1}if(r)try{n.config=new tributary.Config(JSON.parse(r.content))}catch(s){n.config=new tributary.Config}else n.config=new tributary.Config;var o=_.keys(e.files);n.models=new tributary.CodeModels;var u,a,f,l=0,c;o.forEach(function(t){u=t.split("."),c=u[u.length-1],t!=="config.json"&&(a=new tributary.CodeModel({filename:t,name:u[0],code:e.files[t].content,type:c}),n.models.add(a))}),n.config.require(t,n)})},tributary.save_gist=function(e,t,n){var r=tributary.gistid||"",i={description:"just another inlet to tributary","public":e.get("public"),files:{}};e.contexts.forEach(function(e){i.files[e.model.get("filename")]={content:e.model.get("code")}}),i.files["config.json"]={content:JSON.stringify(e.toJSON())};if(e.display==="svg"){var s=d3.select("svg").node(),o=(new XMLSerializer).serializeToString(s);$.browser.webkit&&(o=o.replace(/ xlink/g," xmlns:xlink"),o=o.replace(/ href/g," xlink:href")),i.files["inlet.svg"]={content:o}}var u;t==="save"?u="/tributary/save":t==="fork"&&(u="/tributary/fork"),r.length>4&&(u+="/"+r);var a=this;$.post(u,{gist:JSON.stringify(i)},function(e){typeof e=="string"&&(e=JSON.parse(e));var t=e.id,r="/tributary/"+t;n(r,t)})},tributary.login_gist=function(e,t){var n;e?n="/github-logout":n="/github-login",n+="/tributary",tributary.gistid&&(n+="/"+tributary.gistid),t(n)},tributary.FilesView=Backbone.View.extend({initialize:function(){},render:function(){var e=this,t=d3.select(this.el).selectAll("div").data(this.model.contexts),n=t.enter().append("div").classed("fv",!0);n.on("click",function(t){e.model.trigger("hide"),t.model.trigger("show"),tributary.events.trigger("show","edit")}),n.append("span").text(function(e){return e.model.get("filename")});var r=d3.select(this.el).append("div").classed("fv",!0);r.append("span").text("+");var i=r.append("input").attr({type:"text"}).style({visibility:"hidden"});r.on("click",function(){i.style("visibility","visible"),i.node().focus(),i.on("keypress",function(){if(d3.event.charCode===13){var t=tributary.make_context({filename:i.node().value,config:e.model});t?(e.model.contexts.push(t),t.render(),t.execute(),tributary.make_editor({model:t.model}),e.$el.empty(),e.render()):i.classed("input_error",!0)}})});var s=d3.select(this.el).append("div").attr("id","require-ui");s.append("span").classed("config_title",!0).text("Require:");var o=s.append("div").classed("requirecontrols",!0),u=o.selectAll("div.config").data(this.model.get("require")).enter().append("div").classed("config",!0);u.append("span").text(function(e){return e.name}),u.append("span").text(function(e){return" "+e.url}).classed("description",!0),u.append("span").text("x").classed("delete",!0).on("click",function(t){var n=e.model.get("require"),r=n.indexOf(t);n.splice(r,1),e.model.set("require",n),e.$el.empty(),e.render()});var r=o.append("div").classed("config",!0);r.append("span").text("+ ");var a=r.append("div").text("name: ").style({display:"none"});a.append("input").attr({type:"text"});var f=r.append("div").text("url: ").style({display:"none"});f.append("input").text("url:").attr({type:"text"}),r.on("click",function(){a.style("display",""),f.style("display",""),a.select("input").node().focus();var t=function(){var t={name:a.select("input").node().value,url:f.select("input").node().value},n=e.model.get("require");n.push(t),e.model.set("require",n),e.$el.empty(),e.render()};a.on("keypress",function(){d3.event.charCode===13&&t()}),f.on("keypress",function(){d3.event.charCode===13&&t()})})}}),tributary.FileView=Backbone.View.extend({render:function(){}}),tributary.ControlsView=Backbone.View.extend({initialize:function(){this.model.on("change:play",this.play_button,this),this.model.on("change:loop",this.time_slider,this),this.model.on("change:restart",this.restart_button,this)},render:function(){var e=d3.select(this.el);e.append("div").attr("id","time_controls"),e.append("div").attr("id","user_controls"),e.append("div").attr("id","time_options"),this.play_button(),this.time_slider(),this.restart_button()},play_button:function(){var e=d3.select(this.el).select("#time_controls");if(this.model.get("play")){var t=e.append("button").classed("play",!0).classed("button_on",!0).text("Play");t.on("click",function(e){tributary.pause?tributary.pause&&(t.classed("playing",!0),t.text("Pause")):(t.classed("playing",!1),t.text("Play"));if(tributary.t<1||!tributary.loop)tributary.pause=!tributary.pause,tributary.pause||(tributary.timer.then=new Date,tributary.timer.duration=(1-tributary.t)*tributary.duration,tributary.timer.ctime=tributary.t)})}else e.select("button.play").remove()},time_slider:function(){tributary.loop=this.model.get("loop");var e=d3.select(this.el).select("#time_controls");if(tributary.loop){var t=e.append("input").attr({type:"range",min:0,max:1,step:.01,value:0,name:"time"}).classed("time_slider",!0);$(t.node()).on("change",function(){tributary.t=parseFloat(this.value),tributary.pause&&tributary.execute()}),this.model.on("tick",function(e){$(t.node()).attr("value",tributary.t)});if(this.model.get("display")==="svg"){var n=e.append("button").classed("bv",!0).classed("button_on",!0).text("BV");n.on("click",function(){tributary.bv=!tributary.bv,tributary.events.trigger("execute")})}}else tributary.bv=!1,e.select("input.time_slider").remove(),e.select("button.bv").remove()},restart_button:function(){var e=this,t=d3.select(this.el).select("#time_controls");if(this.model.get("restart")){tributary.autoinit=!1;var n=t.append("button").classed("restart",!0).classed("button_on",!0).text("Restart");n.on("click",function(e){tributary.clear(),tributary.initialize(tributary.g,tributary),tributary.init(tributary.g),tributary.execute()})}else tributary.autoinit=!0,t.select("button.restart").remove()}}),tributary.displays=[{name:"svg",description:"creates an <svg> element for you to use"},{name:"canvas",description:"creates a <canvas> element and gives you a Context for the canvas"},{name:"webgl",description:"gives you a Three.js WebGLRenderer scene"},{name:"div",description:"gives you a plain old <div>"}],tributary.time_controls=[{name:"play",description:"gives you a play button, and tributary.t. if you provide tributary.run(g,t) it will be executed in a run loop"},{name:"loop",description:"gives you a loop where tributary.t goes from 0 to 1."},{name:"restart",description:"assumes you only want tributary.init(g) to be run when the restart button is clicked"}],tributary.make_context=function(e){var t,n,r,i,s=e.config;if(e.model)n=e.model,o=n.get("filename"),i=n.get("type");else{var o,u;e.filename?o=e.filename:o="inlet.js",e.content?u=e.content:u="";var a=o.split(".");i=a[a.length-1],n=new tributary.CodeModel({name:a[0],filename:o,code:u,type:i})}return e.display?r=e.display:r=d3.select("#display"),o==="inlet.js"?t=new tributary.TributaryContext({config:s,model:n,el:r.node()}):i==="json"?t=new tributary.JSONContext({config:s,model:n}):i==="csv"?t=new tributary.CSVContext({config:s,model:n}):i==="js"?t=new tributary.JSContext({config:s,model:n}):i==="cs"?t=new tributary.CSContext({config:s,model:n}):i==="css"?t=new tributary.CSSContext({config:s,model:n}):i==="html",t},tributary.make_editor=function(e){var t=e.model;e.container?container=e.container:container=tributary.edit.append("div").attr("id",t.cid);var n;return n=new tributary.Editor({el:container.node(),model:t}),n.render(),n},d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},tributary.batch={},tributary.batch._execute=function(){var e=_.functions(this);_.each(e,function(e){e!=="_execute"&&tributary.batch[e]()})},tributary.ui={};var display,panel_gui,panel,panel_handle,page,header;return tributary.ui.setup=function(){display=d3.select("#display"),panel_gui=d3.select("#panel_gui"),panel=d3.select("#panel"),panel_handle=d3.select("#panel_handle"),page=d3.select("#page"),header=d3.select("#header"),tributary.dims={display_percent:.7,page_width:0,page_height:0,display_width:0,display_height:0,panel_width:0,panel_height:0,panel_gui_width:0,panel_gui_height:31},tributary.events.on("resize",function(){var e=parseInt(panel.style("min-width"),10);tributary.dims.page_width=parseInt(page.style("width"),10),tributary.dims.page_height=parseInt(page.style("height"),10);if(tributary.dims.page_width-tributary.dims.page_width*tributary.dims.display_percent<e)return;tributary.dims.display_width=tributary.dims.page_width*tributary.dims.display_percent,tributary.dims.panel_width=tributary.dims.page_width-tributary.dims.display_width,tributary.dims.panel_gui_width=tributary.dims.panel_width,tributary.dims.display_height=tributary.dims.page_height-parseInt(header.style("height"),10),tributary.dims.panel_height=tributary.dims.display_height-tributary.dims.panel_gui_height,display.style("width",tributary.dims.display_width+"px"),display.style("height",tributary.dims.display_height+"px"),panel.style("width",tributary.dims.panel_width+"px"),panel.style("height",tributary.dims.panel_height+"px"),panel_gui.style("width",tributary.dims.panel_gui_width+"px"),panel_gui.style("height",tributary.dims.panel_gui_height+"px"),panel_handle.style("right",tributary.dims.panel_width+"px"),tributary.sw=tributary.dims.display_width,tributary.sh=tributary.dims.display_height,tributary.events.trigger("execute")}),tributary.events.trigger("resize");var e=d3.behavior.drag().on("drag",function(){var e=d3.event.dx/tributary.dims.page_width;tributary.dims.display_percent+e>=0&&tributary.dims.display_percent+e<=1&&(tributary.dims.display_percent+=e),tributary.events.trigger("resize")});panel_handle.call(e);var t=["edit","files","config"],n=60,r=panel_gui.selectAll("div.pb").data(t).enter().append("div").classed("pb",!0).attr({id:function(e){return e+"_tab"}}).on("click",function(e){tributary.events.trigger("show",e)}).text(function(e){return e});tributary.events.on("show",function(e){$("#panel").children("div").css("display","none"),panel.select("#"+e).style("display",""),panel_gui.selectAll("div.pb").classed("gui_active",!1),panel_gui.select("#"+e+"_tab").classed("gui_active",!0)}),tributary.events.trigger("show","edit"),$("#hide-panel-button").on("click",function(){tributary.events.trigger("hidepanel"),$("#display").addClass("fullscreen"),$("svg").addClass("fullscreen"),$("#header").addClass("dimheader")}),$("#show-codepanel-button").on("click",function(){tributary.events.trigger("showpanel"),$("#display").removeClass("fullscreen"),$("svg").removeClass("fullscreen"),$("#header").removeClass("dimheader")}),tributary.events.on("hidepanel",function(){$("#panel").hide(),$("#panel_gui").hide(),$("#panel_handle").hide(),$("#show-codepanel").show()}),tributary.events.on("showpanel",function(){$("#panel").show(),$("#panel_gui").show(),$("#panel_handle").show(),$("#show-codepanel").hide()})},tributary.ui.assemble=function(e){tributary.trace=!0;if(e.length>0)tributary.gist(e,_assemble);else{var t={};t.config=new tributary.Config,t.models=new tributary.CodeModels(new tributary.CodeModel),_assemble(t)}},tributary};