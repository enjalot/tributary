(function(){function j(){return!b.ready?(i&&i("midibridge not ready!"),"midibridge not ready!"):!0}function q(){try{c=b.getObject("midibridge-applet")}catch(a){setTimeout(q,25)}}try{console.log("")}catch(u){console={log:function(){}}}var b={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat"},
k=[];k[128]="NOTE OFF";k[144]="NOTE ON";k[160]="POLY PRESSURE";k[176]="CONTROL CHANGE";k[192]="PROGRAM CHANGE";k[208]="CHANNEL PRESSURE";k[224]="PITCH BEND";k[240]="SYSTEM EXCLUSIVE";var n={sharp:"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","),flat:"C,D&#9837;,D,E&#9837;,E,F,G&#9837;,G,A&#9837;,A,B&#9837;,B".split(","),soundfont:"C,Db,D,Eb,E,F,Gb,G,Ab,A,Bb,B".split(","),"enh-sharp":"B#,C#,C##,D#,D##,E#,F#,F##,G#,G##,A#,A##".split(","),"enh-flat":"D&#9837;&#9837;,D&#9837;,E&#9837;&#9837;,E&#9837;,F&#9837;,G&#9837;&#9837;,G&#9837;,A&#9837;&#9837;,A&#9837;,B&#9837;&#9837;,B&#9837;,C&#9837;".split(",")},
e=JSON.parse,m=null,i=null,o=null,c=null,g=!1,h=!1,d=!1,f=!0,r={},p=!1,l={};l[b.NOTE_OFF]=1;l[b.NOTE_ON]=1;l[b.CONTROL_CHANGE]=1;l[b.PITCH_BEND]=1;l[b.PROGRAM_CHANGE]=1;b.version="0.5.2";b.ready=!1;b.noteNameModus=b.NOTE_NAMES_SHARP;b.init=function(a){if("function"===typeof a)m=a;else if("object"===typeof a){p=a.debug;if(a.midiCommands){l={};for(var b=0;b<a.midiCommands.length;b++)l[a.midiCommands[b]]=1}g=a.connectAllInputs;h=a.connectFirstInput;d=a.connectFirstOutput;f=a.connectAllInputsToFirstOutput;
m=a.data;o=a.ready;i=a.error;switch(!0){case f:d=h=g=!1;f=!0;break;case g&&d:d=h=g=!1;f=!0;break;case g:g=!0;f=d=h=!1;break;case d&&h:g=!1;d=h=!0;f=!1;break;case d&&g:d=h=g=!1;f=!0;break;case d:h=g=!1;d=!0;f=!1;break;case h:g=!1;h=!0;f=d=!1;break;case !1==f:f=!1;break;default:f=!0}p&&console.log(h,d,g,f,e,l)}if(navigator.javaEnabled())try{if(void 0===e)console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+");else{var c=document.createElement("div");
c.setAttribute("id","midibridge-java");a="";a=-1===navigator.userAgent.toLowerCase().indexOf("chrome")?a+'<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1"><param name="codebase" value="java/" /><param name="archive" value="midiapplet.jar" /><param name="code" value="net.abumarkub.midi.applet.MidiApplet" /><param name="scriptable" value="true" /><param name="minJavaVersion" value="1.5" />Your browser needs the Java plugin to use the midibridge. You can download it <a href="http://www.java.com/en/" target="blank" title="abumarkub midibridge download java" rel="abumarkub midibridge download java">here</a></object>':
a+'<applet id="midibridge-applet" code="net.abumarkub.midi.applet.MidiApplet.class" archive="midiapplet.jar" codebase="java" width="1" height="1"><param name="minJavaVersion" value="1.5"></applet>';c.innerHTML=a;document.body.appendChild(c)}}catch(v){i?i("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+"):console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else i?i("no java plugin found; install or enable the java plugin"):
console.log("no java plugin found; install or enable the java plugin")};b.msgFromJava=function(a){a=e(a);switch(a.msgId){case "upgrade-java":i?i("please upgrade your java plugin!"):console.log("please upgrade your java plugin!");break;case "midi-started":q();c&&(r=a.devices,b.ready=!0,g&&b.connectAllInputs(),h&&b.connectFirstInput(),d&&b.connectFirstOutput(),f&&b.connectAllInputsToFirstOutput(),o&&o("midibridge started"));break;case "midi-data":if(m){if(void 0===l[a.status]){p&&console.log("MIDI message with status code",
a.status,"intercepted");break}m(new s(a))}break;case "error":i&&i(a.code)}};b.sendMidiEvent=function(a,b,t,d){return j()?e(c.processMidiEvent(a,b,t,d)):!1};b.getDevices=function(){return r};b.refreshDevices=function(){return j()?e(c.getDevices()):!1};b.connectAllInputs=function(){return j()?e(c.connectAllInputs()):!1};b.connectFirstInput=function(){return j()?e(c.connectFirstInput()):!1};b.connectFirstOutput=function(){return j()?e(c.connectFirstOutput()):!1};b.connectAllInputsToFirstOutput=function(){return j()?
e(c.connectAllInputsToFirstOutput()):!1};b.addConnection=function(a,b,d){return j()?(d=void 0===d?[]:d,e(c.addConnection(a,void 0===b?-1:b,d))):!1};b.removeConnection=function(a,b){return j()?e(c.removeConnection(a,b)):!1};b.disconnectAll=function(){return j()?e(c.disconnectAll()):!1};b.loadBase64String=function(a){a.indexOf("data:audio/mid;base64,"===0)&&(a=a.replace("data:audio/mid;base64,",""));return e(c.loadBase64String(a))};b.playBase64String=function(a){return e(c.playBase64String(a))};b.loadMidiFile=
function(a){return e(c.loadMidiFile(a))};b.playMidiFile=function(a){return e(c.playMidiFile(a))};b.startSequencer=function(){c.startSequencer()};b.pauseSequencer=function(){c.pauseSequencer()};b.stopSequencer=function(){c.stopSequencer()};b.closeSequencer=function(){c.closeSequencer()};b.getSequencerPosition=function(){return c.getSequencerPosition()};b.setSequencerPosition=function(a){c.setSequencerPosition(a)};var s=function(){var a=function(a){this.data1=a.data1;this.data2=a.data2;this.status=
a.status;this.status="0"===this.data2&&this.status==b.NOTE_ON?b.NOTE_OFF:this.status;this.channel=a.channel;this.noteName=b.getNoteName(this.data1,b.noteNameModus);this.statusCode=b.getStatus(this.status);this.microsecond=a.microsecond;this.time=b.getNiceTime(this.microsecond)};a.prototype={toString:function(){var a;a=""+(this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.status);return a+=this.microsecond?this.microsecond+" "+this.time:""},toJSONString:function(){return this.microsecond?
"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+", 'microsecond':"+this.microsecond+", 'time':"+this.time+"}":"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+"}"}};return a}();b.MidiMessage=s;b.getNoteName=function(a,b){return n[b][a%12]+""+Math.floor(a/12-1)};b.getNoteNumber=function(a,b){var c=-1,a=a.toUpperCase(),d;for(d in n)for(var e=n[d],f=0,g=e.length;f<g;f++)if(e[f]===a){c=f;break}return-1===
c?"invalid note name":noteNumber=12+c+12*b};b.getStatus=function(a){return k[a]};b.getNiceTime=function(a){var b=a/1E3/1E3>>0,c=b/3600>>0,d=b%3600/60>>0,b=b%60,a=a/1E3-36E5*c-6E4*d-1E3*b+0.5>>0;return""+(0<c?c+":":"")+(0<c?10>d?"0"+d:d:d)+":"+(10>b?"0"+b:b)+":"+(0===a?"000":10>a?"00"+a:100>a?"0"+a:a)};b.getObject=function(a){var b=navigator.userAgent.toLowerCase();return-1!==b.indexOf("msie")||-1!==b.indexOf("webkit")?window[a]:document[a]};window.addEventListener||(window.addEventListener=function(a,
b){window.attachEvent("onload",b)});window.midiBridge=b})(window);