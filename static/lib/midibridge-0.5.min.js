(function(){function q(){try{h=a.getObject("midibridge-applet")}catch(b){setTimeout(q,25);return}}function o(){var a=document.createElement("div");a.setAttribute("id","midibridge-java");var b="";b+='<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1">';b+='<param name="code" value="/static/java/net.abumarkub.midi.applet.MidiApplet" />';b+='<param name="archive" value="/static/java/midiapplet.jar" />';b+='<param name="codebase" value="'+l+'/" />';b+='<param name="scriptable" value="true" />';b+='<param name="minJavaVersion" value="1.5">';b+="</object>";a.innerHTML=b;document.body.appendChild(a)}function n(){if(!a.ready){if(f){f("midibridge not ready!")}return"midibridge not ready!"}return true}var a={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat"};var b=[];b[128]="NOTE OFF";b[144]="NOTE ON";b[160]="POLY PRESSURE";b[176]="CONTROL CHANGE";b[192]="PROGRAM CHANGE";b[208]="CHANNEL PRESSURE";b[224]="PITCH BEND";b[240]="SYSTEM EXCLUSIVE";var c={sharp:["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],flat:["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],"enh-sharp":["B#","C#","C##","D#","D##","E#","F#","F##","G#","G##","A#","A##"],"enh-flat":["D♭♭","D♭","E♭♭","E♭","F♭","G♭♭","G♭","A♭♭","A♭","B♭","B♭","C♭"]};var d=JSON.parse;var e=null;var f=null;var g=null;var h=null;var i=false;var j=false;var k=true;var l="java";var m={};a.version="0.5";a.ready=false;a.noteNameModus=a.NOTE_NAMES_SHARP;a.init=function(a){if(typeof a==="function"){e=a}else if(typeof a==="object"){var b=a;i=b.connectAllInputs;j=b.connectFirstOutput;k=b.connectAllInputsToFirstOutput;e=b.data;g=b.ready;f=b.error;switch(true){case i&&j:i=false;j=false;k=true;break;case k:i=false;j=false;break;case j:i=false;k=false;break;case i:j=false;k=false;break}}if(!navigator.javaEnabled()){if(f){f("no java plugin found; install or enable the java plugin")}else{console.log("no java plugin found; install or enable the java plugin")}return}try{JSON;o()}catch(c){if(f){f("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else{console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}}};a.msgFromJava=function(b){var c=d(b);var l=c.msgId;switch(l){case"upgrade-java":if(f){f("please upgrade your java plugin!")}else{console.log("please upgrade your java plugin!")}break;case"midi-started":q();if(h){m=c.devices;a.ready=true;if(i){a.connectAllInputs()}if(j){a.connectFirstOutput()}if(k){a.connectAllInputsToFirstOutput()}if(g){g("midibridge started")}}break;case"midi-data":if(e){e(new p(c))}break;case"error":if(f){f(c.code)}break}};a.sendMidiEvent=function(a,b,c,e){if(n()){return d(h.processMidiEvent(a,b,c,e))}};a.getDevices=function(){return m};a.refreshDevices=function(){if(n()){return d(h.getDevices())}};a.connectAllInputs=function(){if(n()){return d(h.connectAllInputs())}};a.connectFirstOutput=function(){if(n()){return d(h.connectFirstOutput())}};a.connectAllInputsToFirstOutput=function(){if(n()){return d(h.connectAllInputsToFirstOutput())}};a.addConnection=function(a,b,c){if(n()){b=b==undefined?-1:b;c=c==undefined?[]:c;return d(h.addConnection(a,b,c))}};a.removeConnection=function(a,b){if(n()){return d(h.removeConnection(a,b))}};a.disconnectAll=function(){if(n()){return d(h.disconnectAll())}};var p=function(){var b=function(b){this.data1=b.data1;this.data2=b.data2;this.status=b.status;this.status=this.data2==0&&this.status==a.NOTE_ON?a.NOTE_OFF:this.status;this.channel=b.channel;this.noteName=a.getNoteName(this.data1,a.noteNameModus);this.statusCode=a.getStatus(this.status)};b.prototype={toString:function(){var a="";a+=this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.status;return a},toJSONString:function(){var a="{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+"}";return a}};return b}();a.getNoteName=function(a,b){var d=Math.floor(a/12-1);var e=c[b][a%12];return e+""+d};a.getNoteNumber=function(a,b){var d=-1;a=a.toUpperCase();for(var e in c){var f=c[e];for(var g=0,h=f.length;g<h;g++){if(f[g]===a){d=g;break}}}if(d===-1){return"invalid note name"}noteNumber=12+d+b*12;return noteNumber};a.getStatus=function(a){return b[a]};a.getObject=function(a){var b=navigator.userAgent.toLowerCase();if(b.indexOf("msie")!==-1||b.indexOf("webkit")!==-1){return window[a]}else{return document[a]}};if(!window.addEventListener){window.addEventListener=function(a,b,c){window.attachEvent("onload",b)}}window.midiBridge=a})(window)
